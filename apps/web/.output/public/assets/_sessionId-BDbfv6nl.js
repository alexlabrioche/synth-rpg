import{a as f,b as N,s as b,e as y,f as v,u as w,g as k,h as C,j as e,L as p}from"./main-yqHpe1eZ.js";import{u as S,B as h,F as T}from"./fixed-action-bar-CndZkYAJ.js";const I=d=>{const s=f(),{onSuccess:c,...l}={};return S({mutationFn:({sessionId:n})=>N.post(`/sessions/${n}/turns`),onSuccess:(n,a,x,i)=>{s.setQueryData(b(a.sessionId),r=>({session:n.session,prelude:r?.prelude??null})),s.setQueryData(y(a.sessionId),r=>({events:[...r?.events??[],n.event]})),c?.(n,a,x,i)},...l})};function R(){const{sessionId:d}=v.useParams(),{t:s}=w(),{data:c,isLoading:l,error:n}=k(d),{data:a}=C(d),{mutate:x,isPending:i}=I();if(l)return e.jsx("div",{className:"container py-16",children:e.jsx("p",{className:"text-muted-foreground",children:s("states.loadingSession","Loading session…")})});if(n||!c)return e.jsxs("div",{className:"container py-16 space-y-4",children:[e.jsx("p",{className:"text-destructive",children:s("states.sessionError","Unable to load this session.")}),e.jsx(h,{variant:"outline",asChild:!0,children:e.jsxs(p,{to:"/",children:["← ",s("session.actions.backToCharacter","Back to characters")]})})]});const{session:r,prelude:o}=c,u=a?.events??[],g=()=>{i||x({sessionId:r.id})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container py-10 pb-32 space-y-10",children:[e.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s("session.title","Session")}),e.jsxs("h1",{className:"text-3xl font-semibold",children:[s("session.meta.turn","Turn")," ",r.turn]})]}),e.jsx(h,{variant:"outline",asChild:!0,children:e.jsxs(p,{to:"/characters/$characterId",params:{characterId:r.characterId},children:["← ",s("session.actions.backToCharacter","Back to character")]})})]}),o?e.jsxs("section",{className:"rounded-2xl border border-border bg-card p-6 shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s("session.sections.prelude","Prelude")}),e.jsx("h2",{className:"text-2xl font-semibold mt-1",children:o.title})]}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-line leading-relaxed",children:o.narrative}),o.instructions?e.jsx("p",{className:"text-sm text-foreground font-medium",children:o.instructions}):null]}):null,e.jsxs("section",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s("session.sections.events","Events")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.length," ",s("session.sections.eventCount","entries")]})]}),u.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s("session.empty.events","No events yet. Roll to awaken the world.")}):e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsxs("article",{className:"rounded-2xl border border-border bg-card/80 p-5 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-muted-foreground",children:[e.jsx("span",{children:s(`session.events.${t.kind.toLowerCase()}`,t.kind)}),e.jsxs("span",{children:[s("session.meta.turn","Turn")," ",t.turn]})]}),e.jsx("h3",{className:"text-lg font-semibold",children:t.title}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-line",children:t.narrativeContext}),e.jsxs("div",{className:"grid gap-3 pt-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s("session.events.gearStrategy","Gear cue")}),e.jsx("p",{className:"text-sm text-foreground",children:t.gearStrategy})]}),e.jsxs("div",{className:"rounded-xl bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s("session.events.abstractPrompt","Abstract prompt")}),e.jsx("p",{className:"text-sm text-foreground",children:t.abstractPrompt})]})]}),t.nextHook?e.jsxs("p",{className:"text-sm italic text-muted-foreground",children:[s("session.events.nextHook","Next hook:")," ",e.jsx("span",{className:"text-foreground",children:t.nextHook})]}):null,t.tags?.length?e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:t.tags.map((m,j)=>e.jsxs("span",{className:"rounded-full border border-border/60 bg-card/60 px-3 py-1 text-xs text-muted-foreground",children:[m.type?e.jsx("span",{className:"uppercase tracking-wide text-[10px] mr-1",children:m.type}):null,e.jsx("span",{className:"text-foreground font-medium",children:m.value})]},`${t.id}-tag-${j}`))}):null]},t.id))})]})]}),e.jsx(T,{title:s("session.actions.nextTurnTitle","Advance the story"),description:s("session.actions.nextTurnSubtitle","Roll to discover what the world throws at you next."),actionLabel:s("session.actions.rollNext","Roll next turn"),actionLoadingLabel:s("session.actions.rolling","Rolling next turn…"),onAction:g,disabled:i,loading:i})]})}export{R as component};
